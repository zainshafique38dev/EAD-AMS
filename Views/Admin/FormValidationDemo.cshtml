@model MessManagementSystem.Models.Teacher

@{
    ViewData["Title"] = "Form Validation Demo";
}

<div class="row">
    <div class="col-12 mb-4">
        <div class="alert alert-info">
            <h5><i class="fas fa-info-circle"></i> Form Validation Demo</h5>
            <p class="mb-0">This page demonstrates:</p>
            <ul class="mb-0 mt-2">
                <li><strong>Client-side validation</strong> - jQuery Validate + Unobtrusive (instant feedback)</li>
                <li><strong>Server-side validation</strong> - Data Annotations on Model (secure validation)</li>
                <li><strong>Custom validation</strong> - Business logic checks (duplicate email/username)</li>
            </ul>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-user-plus"></i> Add Teacher (With Validation)</h5>
            </div>
            <div class="card-body p-4">
                
                <!-- Server-side validation summary -->
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <h6><i class="fas fa-exclamation-triangle"></i> Server-Side Validation Errors:</h6>
                        <ul class="mb-0">
                            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@error.ErrorMessage</li>
                            }
                        </ul>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                @if (ViewBag.Error != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> @ViewBag.Error
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                @if (ViewBag.Success != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle"></i> @ViewBag.Success
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <!-- Form with both client-side and server-side validation -->
                <form asp-action="FormValidationDemo" method="post" id="validationForm">
                    @Html.AntiForgeryToken()

                    <h6 class="text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-user"></i> Personal Information
                    </h6>

                    <!-- Full Name - Required, MinLength, MaxLength -->
                    <div class="mb-3">
                        <label asp-for="FullName" class="form-label fw-bold">
                            Full Name <span class="text-danger">*</span>
                        </label>
                        <input asp-for="FullName" class="form-control" placeholder="Enter full name (2-100 characters)" />
                        <span asp-validation-for="FullName" class="text-danger"></span>
                        <small class="text-muted">Server validates: Required, 2-100 characters</small>
                    </div>

                    <!-- Email - Required, Valid Email Format -->
                    <div class="mb-3">
                        <label asp-for="Email" class="form-label fw-bold">
                            Email Address <span class="text-danger">*</span>
                        </label>
                        <input asp-for="Email" class="form-control" placeholder="teacher@example.com" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                        <small class="text-muted">Server validates: Required, valid email format, unique</small>
                    </div>

                    <!-- Phone - Required, Valid Phone Format -->
                    <div class="mb-3">
                        <label asp-for="PhoneNumber" class="form-label fw-bold">
                            Phone Number <span class="text-danger">*</span>
                        </label>
                        <input asp-for="PhoneNumber" class="form-control" placeholder="+1234567890" />
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        <small class="text-muted">Server validates: Required, valid phone format</small>
                    </div>

                    <!-- Department - Required, MinLength, MaxLength -->
                    <div class="mb-3">
                        <label asp-for="Department" class="form-label fw-bold">
                            Department <span class="text-danger">*</span>
                        </label>
                        <input asp-for="Department" class="form-control" placeholder="e.g., Mathematics, Physics" />
                        <span asp-validation-for="Department" class="text-danger"></span>
                        <small class="text-muted">Server validates: Required, 2-100 characters</small>
                    </div>

                    <hr />
                    <h6 class="text-primary border-bottom pb-2 mb-3">
                        <i class="fas fa-key"></i> Login Credentials
                    </h6>

                    <!-- Username - Required, Custom Format -->
                    <div class="mb-3">
                        <label for="username" class="form-label fw-bold">
                            Username <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="username" name="username" class="form-control" 
                               placeholder="Choose username (letters, numbers, underscore)"
                               required minlength="3" maxlength="50"
                               pattern="^[a-zA-Z0-9_]+$"
                               value="@ViewBag.Username" />
                        <div class="invalid-feedback">Username must be 3-50 characters (letters, numbers, underscore only)</div>
                        <small class="text-muted">Server validates: Required, 3-50 chars, alphanumeric+underscore, unique</small>
                    </div>

                    <!-- Password - Required, MinLength -->
                    <div class="mb-4">
                        <label for="password" class="form-label fw-bold">
                            Password <span class="text-danger">*</span>
                        </label>
                        <input type="password" id="password" name="password" class="form-control" 
                               placeholder="Minimum 6 characters"
                               required minlength="6" />
                        <div class="invalid-feedback">Password must be at least 6 characters</div>
                        <small class="text-muted">Server validates: Required, minimum 6 characters</small>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back
                        </a>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-save"></i> Submit (Test Validation)
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Validation Info Card -->
    <div class="col-lg-4">
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0"><i class="fas fa-check-circle"></i> Client-Side Validation</h6>
            </div>
            <div class="card-body">
                <p class="small">Powered by jQuery Validate + Unobtrusive:</p>
                <ul class="small mb-0">
                    <li>Instant feedback on blur</li>
                    <li>Prevents form submission if invalid</li>
                    <li>Uses data-val-* attributes from model</li>
                    <li>No page reload needed</li>
                </ul>
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header bg-warning">
                <h6 class="mb-0"><i class="fas fa-server"></i> Server-Side Validation</h6>
            </div>
            <div class="card-body">
                <p class="small">Data Annotations on Model:</p>
                <ul class="small mb-0">
                    <li>[Required] - Field is required</li>
                    <li>[StringLength] - Min/max length</li>
                    <li>[EmailAddress] - Valid email format</li>
                    <li>[Phone] - Valid phone format</li>
                    <li>[RegularExpression] - Pattern match</li>
                    <li>ModelState.IsValid check</li>
                </ul>
            </div>
        </div>

        <div class="card shadow">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0"><i class="fas fa-shield-alt"></i> Custom Validation</h6>
            </div>
            <div class="card-body">
                <p class="small">Business logic checks in Controller:</p>
                <ul class="small mb-0">
                    <li>Duplicate email check</li>
                    <li>Duplicate username check</li>
                    <li>Password policy enforcement</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Include jQuery Validation Scripts for client-side validation -->
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Additional custom client-side validation
            $('#validationForm').on('submit', function(e) {
                // Add Bootstrap validation classes
                this.classList.add('was-validated');
                
                // Check if jQuery Validate says form is invalid
                if (!$(this).valid()) {
                    e.preventDefault();
                    return false;
                }
            });

            // Real-time validation feedback with Bootstrap classes
            $('input').on('blur', function() {
                if ($(this).valid()) {
                    $(this).removeClass('is-invalid').addClass('is-valid');
                } else {
                    $(this).removeClass('is-valid').addClass('is-invalid');
                }
            });

            // Clear validation state on input
            $('input').on('input', function() {
                $(this).removeClass('is-valid is-invalid');
            });
        });
    </script>
}
